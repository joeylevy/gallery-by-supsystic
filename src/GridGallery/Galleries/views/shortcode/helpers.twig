{% set figureStyle %}
	{% if settings.thumbnail.border.type != 'none' %}
		border: {{ settings.thumbnail.border.width }}px {{ settings.thumbnail.border.type }} {{ settings.thumbnail.border.color }};
	{% endif %}
	border-radius: {{ settings.thumbnail.border.radius ~ settings.thumbnail.border.radius_unit|replace(['px', '%']) }};
	{% if settings.use_shadow == 1 %}
		box-shadow: {{ settings.thumbnail.shadow.x }}px {{ settings.thumbnail.shadow.y }}px {{ settings.thumbnail.shadow.blur }}px {{ settings.thumbnail.shadow.color }};
	{% endif %};
	margin: {{ settings.area.distance }}px;
	{#-webkit-mask-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC);#}
	{% if settings.area.grid == '2' %}
		height:{{ settings.area.photo_height ~ settings.area.photo_height_unit|replace(['px', '%']) }};
	{% endif %}
	{% if settings.area.grid == '2' %}
		width:auto;
	{% else %}
		width:{{ settings.area.photo_width ~ settings.area.photo_width_unit|replace(['px', '%']) }};
	{% endif %}
{% endset %}
	
{% set aTitle %}
	{% if photo.attachment.description is defined and photo.attachment.description is not empty %}
		{{ photo.attachment.description }}
	{% else %}
		{{ photo.attachment.title }}
	{% endif %}
{% endset %}

{% set aClass %}
	{% if (photo.attachment.external_link is not defined or photo.attachment.external_link|trim is empty) and (photo.attachment.video is not defined or photo.attachment.video|trim is empty) and settings.box.type == '0' %}
		gg-colorbox
	{% endif %}

	{% if photo.attachment.video is defined and photo.attachment.video|trim is not empty and settings.box.type == '0' %}
		gg-video
	{% endif %}

	{% if settings.box.type == '2' and (photo.attachment.external_link is not defined or photo.attachment.external_link|trim is empty) %}
		pbox
	{% endif %}
{% endset %}

{% set aHref %}
	{% if photo.attachment.external_link is defined and photo.attachment.external_link is not empty %}
		{{ photo.attachment.external_link|force_http }}
		{% set link = true %}
	{% else %}
		{{ photo.attachment.sizes.full.url }}
	{% endif %}
{% endset %}

{% block figure_before %}
	{% if environment.isPro() == false or settings.icons is not defined or settings.icons.enabled == 'false' %}
		<a
			{% block a_attributes %}
				class="gg-link {{ aClass|trim }}"
				href="{{ aHref|trim }}"
				target="{{ photo.attachment.target|default('_self') }}"
				title="{{ aTitle|trim }}"
				{% if settings.box.type == '1' and link == false %}
					rel="prettyPhoto[pp_gal]"
				{% endif %}
				style="border-radius: {{ settings.thumbnail.border.radius ~ settings.thumbnail.border.radius_unit|replace(['px', '%']) }};"
			{% endblock %}
		>
	{% endif %}
{% endblock %}

{% set galleryType %}
	{% if settings.thumbnail.overlay.enabled == 'false' %}
		none
	{% else %}
		{% if settings.thumbnail.overlay.personal == 'true' %}
			{{ photo.attachment.captionEffect|default(settings.thumbnail.overlay.effect) }}
		{% else %}
			{{ settings.thumbnail.overlay.effect }}
		{% endif %}
	{% endif %}
{% endset %}

	<figure 
		{% block figure_attributes %}
			class="grid-gallery-caption
			{% if settings.mouse_shadow == '1' and settings.use_shadow == '1' %} 
				shadow-show
			{% endif %}
			{% if settings.mouse_shadow == '2' and settings.use_shadow == '1' %}
			 shadow-hide
			{% endif %}"
			data-grid-gallery-type="{{ galleryType|trim }}"
			style="display:none;{{ figureStyle|trim }}"
		{% endblock %}>

		<div class="crop
			{% if settings.thumbnail.shadow.overlay == '1' and settings.use_shadow == '1' %}
				image-overlay
			{% endif %}" 
			style="
			{% if settings.area.grid == '0' or settings.area.grid == '3' %}
				width:{{ settings.area.photo_width ~ settings.area.photo_width_unit|replace(['px', '%']) }};
				height:{{ settings.area.photo_height ~ settings.area.photo_height_unit|replace(['px', '%']) }};
				overflow:hidden;
			{% endif %}">

			{% set width, height, crop = 0, 0, 0 %}

			{% if settings.area.photo_width_unit == 0 %}
				{% set width = settings.area.photo_width %}
			{% endif %}

			{% if settings.area.photo_height_unit == 0 %}
				{% set height = settings.area.photo_height %}
			{% endif %}
		
			{% if settings.area.grid == 0 or settings.area.grid == '2' or settings.area.grid == '3' %}
				{% set crop = 1 %}
			{% else %}
				{% set height = null %}
			{% endif %}

			<img
				{% block image_attributes %}
				src="{{ get_attachment(photo.attachment.id, width, height, crop) }}"
				alt="{% if photo.attachment.alt is not empty %}{{ photo.attachment.alt }}{% else %}{{ photo.attachment.title }}{% endif %}"
				title="{% if photo.attachment.description is not empty %}{{ photo.attachment.description }}{% else %}{{ photo.attachment.title }}{% endif %}"
				data-caption="{% if photo.attachment.caption is not empty %}{{ photo.attachment.caption }}{% else %}{{ photo.attachment.title }}{% endif %}"
				style="border-radius: {{ settings.thumbnail.border.radius ~ settings.thumbnail.border.radius_unit|replace(['px', '%']) }};"
				{% endblock %}
			/>
		</div>

		{% set figcaptionStyle %}
			border-radius: {{ settings.thumbnail.border.radius ~ settings.thumbnail.border.radius_unit|replace(['px', '%']) }};

			{% block figcaption_style %}
				color:{{ settings.thumbnail.overlay.foreground }};
				background-color:{{ settings.thumbnail.overlay.background }};
				font-size:{{ settings.thumbnail.overlay.text_size }}{{ settings.thumbnail.overlay.text_size_unit|replace(['px', '%', 'em']) }};
				text-align:{{ settings.thumbnail.overlay.text_align }};
				font-family:{{ settings.thumbnail.overlay.font_family }};
				{% if settings.thumbnail.overlay.effect == 'none' or settings.thumbnail.overlay.enabled == 'false' %}
					opacity:1;
					bottom:0;
				{% endif %}
			{% endblock %}

		{% endset %}

		<figcaption 
			{% block figcaption_attributes %}
				data-alpha="{{ settings.thumbnail.overlay.transparency|trim }}" 
				style="{{ figcaptionStyle|trim }}" 
			{% endblock %}>

			<div 
				class="grid-gallery-figcaption-wrap" 
				style="
				{% if environment.isPro() == false or settings.icons is not defined or settings.icons.enabled == 'false' %}
					vertical-align:{{ settings.thumbnail.overlay.position }};
				{% endif %}">

				{% block figcaption_wrap %}
					{% if environment.isPro() == false or settings.icons is not defined or settings.icons.enabled == 'false' %}
						{% if settings.thumbnail.overlay.enabled == 'true' %}
							{% if photo.attachment.caption is not empty %}
								<span style="font-size:{{ settings.thumbnail.overlay.text_size }}{{ settings.thumbnail.overlay.text_size_unit|replace(['px', '%', 'em']) }};">{{ photo.attachment.caption|raw }}</span>
							{% else %}
								<span style="font-size:{{ settings.thumbnail.overlay.text_size }}{{ settings.thumbnail.overlay.text_size_unit|replace(['px', '%', 'em']) }};">{{ photo.attachment.title|raw }}</span>
							{% endif %}
						{% endif %}
					{% endif %} 
				{% endblock %}
			</div>
		</figcaption>
		
		{% block figcaption_after %}     
		{% endblock %}

	</figure>
{% block figure_after %}     
	{% if environment.isPro() == false or settings.icons is not defined or settings.icons.enabled == 'false' %}
		</a>
	{% endif %}
{% endblock %}
